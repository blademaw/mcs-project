\begin{figure}[h]
\centering

\begin{tikzpicture}[scale=1.1]
    \def\ioffset{0.525} % x axis maximum
    \def\matsize{5}
    
    % Draw labels
    \foreach \i in {0,1}
        \path (\i+\ioffset,-1+\ioffset) node{\i} (-1+\ioffset,\i+\ioffset) node{\i};
    \path (2+\ioffset,-1+\ioffset) node{$\dots$} (-1+\ioffset,2+\ioffset) node[rotate=90] {$\dots$};
    \path (3+\ioffset,-1+\ioffset) node{$i$} (-1+\ioffset,3+\ioffset) node{$j$};
    \path (4+\ioffset,-1+\ioffset) node{$\dots$} (-1+\ioffset,4+\ioffset) node[rotate=90] {$\dots$};
    \path (\matsize+\ioffset,-1+\ioffset) node{$N_b$} (-1+\ioffset,\matsize+\ioffset) node{$N_b$};
      
    % Draw lattice rects
    \foreach \i in {0,...,\matsize}
        \foreach \j in {0,...,\matsize}{
            % Check if current cell is (1,2) or (3,4) and color green
            \ifthenelse{\(\i=0 \AND \j=0\) \OR \(\i=0 \AND \j=2\) \OR \(\i=0 \AND \j=3\) \OR \(\i=0 \AND \j=4\) \OR \(\i=1 \AND \j=0\) \OR \(\i=1 \AND \j=1\) \OR \(\i=1 \AND \j=2\) \OR \(\i=2 \AND \j=0\) \OR \(\i=2 \AND \j=1\) \OR \(\i=2 \AND \j=2\) \OR \(\i=2 \AND \j=4\) \OR \(\i=3 \AND \j=1\) \OR \(\i=3 \AND \j=3\) \OR \(\i=3 \AND \j=4\) \OR \(\i=4 \AND \j=0\) \OR \(\i=4 \AND \j=4\) \OR \(\i=4 \AND \j=5\) \OR \(\i=5 \AND \j=0\) \OR \(\i=5 \AND \j=3\) \OR \(\i=5 \AND \j=4\)}{
                \fill[s-color] (\i+0.1,\j+0.1) rectangle (\i+0.95,\j+0.95);
            }{}

            \ifthenelse{\(\i=3 \AND \j=0\) \OR \(\i=4 \AND \j=3\) \OR \(\i=4 \AND \j=2\) \OR \(\i=2 \AND \j=5\)}{
                \fill[i-color] (\i+0.1,\j+0.1) rectangle (\i+0.95,\j+0.95);
            }{}

            \ifthenelse{\(\i=1 \AND \j=5\) \OR \(\i=5 \AND \j=5\) \OR \(\i=4 \AND \j=1\)}{
                \fill[r-color] (\i+0.1,\j+0.1) rectangle (\i+0.95,\j+0.95);
            }{}

            
            \draw[thick] (\i+0.1,\j+0.1) rectangle (\i+0.95,\j+0.95);
        };

    % Draw agents
    % R agents
    % \node[person,shirt=r-color,scale=1.2] at (1.1+\ioffset,5.3+\ioffset) {};
    % \node[person,shirt=r-color,scale=1.2] at (1-.1+\ioffset,5+\ioffset) {};
    
    % S agents
    % \node[person,shirt=s-color,scale=1.2] at (1-.1+\ioffset,1-.1+\ioffset) {};
    
    % \node[person,shirt=s-color,scale=1.2] at (2.1+\ioffset,1.3+\ioffset) {};
    % \node[person,shirt=s-color,scale=1.2] at (2-.1+\ioffset,1+\ioffset) {};

    % I agents
    % \node[black,scale=1.1] at (3-.1+\ioffset,0.1+\ioffset) {\usymH{1F6B9}{.9cm}};
    % \node[i-color] at (3-.1+\ioffset,0.1+\ioffset) {\usymH{1F6B9}{.8cm}};
    % \node[i-color] at (3-.1+\ioffset,0.1+\ioffset) {};

    \node[isosceles triangle, isosceles triangle apex angle=90, fill=s-color, minimum size=.66cm, rotate=225] at (4.38,2.37) {};
    \draw[thick] (4+0.1,2+0.1) rectangle (4+0.95,2+0.95);

    \newcommand{\drawagent}[1]{
    \path[draw=black,fill=#1,miter limit=10.0,scale=.3] (1.6431, -0.2275).. controls (1.5055, -0.2275) and (1.3944, -0.3387) .. (1.3944, -0.4763).. controls (1.3944, -0.6138) and (1.5055, -0.725) .. (1.6431, -0.725).. controls (1.7806, -0.725) and (1.8918, -0.6138) .. (1.8918, -0.4763).. controls (1.8918, -0.3387) and (1.7806, -0.2275) .. (1.6431, -0.2275) -- cycle(1.3679, -0.7911).. controls (1.1906, -0.7911) and (1.0478, -0.934) .. (1.0478, -1.1113) -- (1.0478, -1.8838).. controls (1.0478, -1.9447) and (1.0954, -1.9923) .. (1.1562, -1.9923).. controls (1.2171, -1.9923) and (1.2647, -1.9447) .. (1.2647, -1.8838) -- (1.2647, -1.1853) -- (1.3203, -1.1853).. controls (1.3203, -1.1853) and (1.3203, -3.0057) .. (1.3203, -3.1247).. controls (1.3203, -3.2041) and (1.3864, -3.2703) .. (1.4658, -3.2703).. controls (1.5478, -3.2703) and (1.6113, -3.2041) .. (1.6113, -3.1247) -- (1.6113, -1.9976) -- (1.6722, -1.9976) -- (1.6722, -3.1247).. controls (1.6722, -3.2041) and (1.7383, -3.2703) .. (1.8177, -3.2703).. controls (1.8997, -3.2703) and (1.9632, -3.2041) .. (1.9632, -3.1247) -- (1.9632, -1.1853) -- (2.0188, -1.1853) -- (2.0188, -1.8838).. controls (2.0188, -1.9447) and (2.0664, -1.9923) .. (2.1273, -1.9923).. controls (2.1881, -1.9923) and (2.2357, -1.9447) .. (2.2357, -1.8838) -- (2.2357, -1.1086).. controls (2.2357, -0.9313) and (2.0902, -0.7885) .. (1.9156, -0.7885).. controls (1.9182, -0.7911) and (1.3679, -0.7911) .. (1.3679, -0.7911) -- cycle;
    }

    \newcommand{\drawagentat}[3]{
    \tikzset{shift={(#2,#3)}}
    
    \path[draw=black,fill=#1,miter limit=10.0,scale=.3] (1.6431, -0.2275).. controls (1.5055, -0.2275) and (1.3944, -0.3387) .. (1.3944, -0.4763).. controls (1.3944, -0.6138) and (1.5055, -0.725) .. (1.6431, -0.725).. controls (1.7806, -0.725) and (1.8918, -0.6138) .. (1.8918, -0.4763).. controls (1.8918, -0.3387) and (1.7806, -0.2275) .. (1.6431, -0.2275) -- cycle(1.3679, -0.7911).. controls (1.1906, -0.7911) and (1.0478, -0.934) .. (1.0478, -1.1113) -- (1.0478, -1.8838).. controls (1.0478, -1.9447) and (1.0954, -1.9923) .. (1.1562, -1.9923).. controls (1.2171, -1.9923) and (1.2647, -1.9447) .. (1.2647, -1.8838) -- (1.2647, -1.1853) -- (1.3203, -1.1853).. controls (1.3203, -1.1853) and (1.3203, -3.0057) .. (1.3203, -3.1247).. controls (1.3203, -3.2041) and (1.3864, -3.2703) .. (1.4658, -3.2703).. controls (1.5478, -3.2703) and (1.6113, -3.2041) .. (1.6113, -3.1247) -- (1.6113, -1.9976) -- (1.6722, -1.9976) -- (1.6722, -3.1247).. controls (1.6722, -3.2041) and (1.7383, -3.2703) .. (1.8177, -3.2703).. controls (1.8997, -3.2703) and (1.9632, -3.2041) .. (1.9632, -3.1247) -- (1.9632, -1.1853) -- (2.0188, -1.1853) -- (2.0188, -1.8838).. controls (2.0188, -1.9447) and (2.0664, -1.9923) .. (2.1273, -1.9923).. controls (2.1881, -1.9923) and (2.2357, -1.9447) .. (2.2357, -1.8838) -- (2.2357, -1.1086).. controls (2.2357, -0.9313) and (2.0902, -0.7885) .. (1.9156, -0.7885).. controls (1.9182, -0.7911) and (1.3679, -0.7911) .. (1.3679, -0.7911) -- cycle;

    \tikzset{shift={(-#2,-#3)}}
    }

    % S agents
    \tikzset{shift={(.4+\ioffset,1.7+\ioffset)}}
        \drawagent{s-color}
    \tikzset{shift={(1.25,.25)}}
        \drawagent{s-color}
    \tikzset{shift={(-.35,-.25)}}
        \drawagent{s-color}

    % R agents
    \tikzset{shift={(-.95,4.2)}}
        \drawagent{r-color}
    \tikzset{shift={(.3,-.1)}}
        \drawagent{r-color}
    \tikzset{shift={(-.2,-.15)}}
        \drawagent{r-color}

    % I agent
    \tikzset{shift={(1.85,-4.7)}}
        \drawagent{i-color}

    % S and I agent
    \tikzset{shift={(1.4,2.05)}}
        \drawagent{i-color}
    \tikzset{shift={(-.35,-.23)}}
        \drawagent{s-color}

    % Equations
    \tikzset{shift={(3.25, 1.8)}}
    \node[] at (0,0) {\textbf{(a)}};
    \drawagentat{s-color}{0.2}{-.1}
    \drawagentat{i-color}{0.6}{-.8}
    \path[->, draw, thick] (1.8, -1) -- (3, -1);
    \node at (2.4, -.7) {$\beta$};
    
    \drawagentat{i-color}{3.1}{-.1}
    \drawagentat{i-color}{3.5}{-.8}

    \tikzset{shift={(0, -3)}}
    \node[] at (0,0) {\textbf{(b)}};
    \drawagentat{i-color}{0.4}{-.1}
    \path[->, draw, thick] (1.6, -.5) -- (3, -.5);
    \node at (2.2, -.2) {$\gamma$};
    \drawagentat{r-color}{3.1}{-.1}
    
    
\end{tikzpicture}

\bcaption{Example ABM of SIR dynamics on a lattice.}{Agents with different SIR states move randomly from any cell to any orthogonally adjacent cell. Teal agents are susceptible, red agents are infected, and purple agents are recovered. Not all agents are shown. (Multi-)coloured cells correspond to the SIR state of agents within that cell, and white cells are unoccupied. \textbf{(a)} Susceptible agents that share a cell with infected agents are infected with probability $\beta$ during each time step. \textbf{(b)} Infected agents recover after an average $1/\gamma$ time steps. Adapted from \citet{paoluzzi_single-agent_2021}.}
\label{sir-abm-diag}
\end{figure}